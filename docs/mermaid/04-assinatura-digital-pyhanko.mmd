graph TD
    A[ðŸ‘¤ UsuÃ¡rio Solicita Assinatura] --> B[ðŸ“ Upload Certificado PFX]
    B --> C[ðŸ”‘ Informa Senha PFX]
    C --> D{ðŸ”’ ValidaÃ§Ã£o OpenSSL}
    D -->|âœ… VÃ¡lido| E[ðŸ“„ Preparar PDF Base]
    D -->|âŒ InvÃ¡lido| F[âš ï¸ Erro: Certificado InvÃ¡lido]

    E --> G{ðŸ“‹ PDF tem Campo Assinatura?}
    G -->|âŒ NÃ£o| H[âž• Criar Campo AssinaturaDigital]
    G -->|âœ… Sim| I[ðŸ³ Docker Run --rm PyHanko]
    H --> I

    I --> J[ðŸ›¡ï¸ PyHanko Container EfÃªmero]
    J --> K[ðŸ“ Processar PAdES B-LT]
    K --> L[â° Adicionar Timestamp TSA]
    L --> M[ðŸ“¦ Embarcar CRL/OCSP]
    M --> N[âœ… PDF Assinado Gerado]

    N --> O{ðŸ” ValidaÃ§Ã£o AutomÃ¡tica}
    O -->|âœ… VÃ¡lido| P[ðŸ’¾ Salvar PDF Final]
    O -->|âŒ InvÃ¡lido| Q[âš ï¸ Erro na Assinatura]

    P --> R[ðŸŽ‰ Assinatura ConcluÃ­da]

    style A fill:#e1f5fe,stroke:#01579b
    style J fill:#fff3e0,stroke:#f57c00
    style N fill:#e8f5e8,stroke:#2e7d32
    style R fill:#f3e5f5,stroke:#7b1fa2