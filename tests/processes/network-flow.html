<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Rede Interativo - Sistema Legisinc</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f0f23 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="grid" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity:0.03" /><stop offset="100%" style="stop-color:rgb(255,255,255);stop-opacity:0" /></radialGradient></defs><rect width="100" height="100" fill="url(%23grid)" /></svg>') repeat;
            opacity: 0.1;
            pointer-events: none;
            z-index: -1;
        }

        .network-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* Header moderno */
        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px 30px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }

        .header .subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-top: 4px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .header-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Painel lateral esquerdo */
        .left-panel {
            position: absolute;
            top: 120px;
            left: 20px;
            width: 280px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .panel-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #ffffff;
        }

        /* Controles melhorados */
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .btn.primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
        }

        .btn.success { 
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border-color: transparent;
        }

        .btn.warning { 
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-color: transparent;
        }

        .btn.danger { 
            background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
            border-color: transparent;
        }

        /* Configura√ß√µes */
        .config-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .config-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.2);
            transition: 0.3s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        .range-slider {
            width: 100%;
            margin: 8px 0;
        }

        .range-input {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }

        /* Painel direito - Stats melhorado */
        .right-panel {
            position: absolute;
            top: 120px;
            right: 20px;
            width: 300px;
            z-index: 1000;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 16px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Performance monitor melhorado */
        .perf-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .perf-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 4px 0 12px 0;
            overflow: hidden;
        }

        .perf-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .perf-cpu { background: linear-gradient(90deg, #fc466b 0%, #3f5efb 100%); }
        .perf-memory { background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%); }
        .perf-network { background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); }

        /* Legenda melhorada */
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .legend-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        /* SVG e rede */
        .network-svg {
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        .network-svg:active {
            cursor: grabbing;
        }

        /* Estilos dos n√≥s melhorados */
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node:hover {
            filter: brightness(1.3) drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }

        .node-circle {
            transition: all 0.3s ease;
        }

        .node-user { 
            fill: url(#gradientUser);
            stroke: #667eea;
            stroke-width: 2;
        }

        .node-process { 
            fill: url(#gradientProcess);
            stroke: #f093fb;
            stroke-width: 2;
        }

        .node-document { 
            fill: url(#gradientDocument);
            stroke: #11998e;
            stroke-width: 2;
        }

        .node-system { 
            fill: url(#gradientSystem);
            stroke: #fc466b;
            stroke-width: 2;
        }

        .node-active {
            animation: pulse-glow 1.5s infinite;
        }

        .node-success {
            filter: brightness(1.2) drop-shadow(0 0 15px #38ef7d);
        }

        .node-error {
            filter: brightness(1.2) drop-shadow(0 0 15px #fc466b);
            animation: shake 0.5s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { 
                filter: brightness(1) drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
                transform: scale(1);
            }
            50% { 
                filter: brightness(1.3) drop-shadow(0 0 20px rgba(255, 255, 255, 0.8));
                transform: scale(1.1);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        /* Links melhorados */
        .link {
            stroke-width: 2;
            fill: none;
            opacity: 0.7;
            transition: all 0.3s ease;
        }

        .link-default { stroke: rgba(255, 255, 255, 0.3); }
        .link-active { 
            stroke: #667eea;
            stroke-width: 3;
            opacity: 1;
            filter: drop-shadow(0 0 5px #667eea);
        }
        .link-success { 
            stroke: #38ef7d;
            stroke-width: 3;
            opacity: 1;
        }
        .link-error { 
            stroke: #fc466b;
            stroke-width: 3;
            opacity: 1;
            animation: error-pulse 1s infinite;
        }

        @keyframes error-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Labels dos n√≥s */
        .node-label {
            font-size: 11px;
            font-weight: 600;
            text-anchor: middle;
            dominant-baseline: middle;
            fill: white;
            pointer-events: none;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.7);
        }

        .node-icon {
            font-size: 16px;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
        }

        /* Tooltip melhorado */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            pointer-events: none;
            z-index: 2000;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            max-width: 250px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip h4 {
            margin: 0 0 8px 0;
            color: #667eea;
            font-size: 0.9rem;
        }

        /* Info panel */
        .info-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(20px);
            max-width: 320px;
            display: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .info-panel.show {
            display: block;
            animation: slideInUp 0.3s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsivo Melhorado */
        @media (max-width: 1400px) {
            .left-panel,
            .right-panel {
                width: 260px;
            }
        }

        @media (max-width: 1200px) {
            .left-panel,
            .right-panel {
                width: 240px;
            }
            
            .panel-card {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }

        @media (max-width: 1024px) {
            .left-panel {
                width: 280px;
                top: 100px;
                max-height: calc(100vh - 120px);
            }
            
            .right-panel {
                display: none; /* Ocultar painel direito em tablets */
            }
            
            .legend {
                bottom: 10px;
                left: 10px;
                right: 300px; /* Deixar espa√ßo para painel esquerdo */
            }
        }

        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
            
            .header {
                padding: 12px 15px;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 2000;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .header .subtitle {
                font-size: 0.8rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            /* Painel m√≥vel colaps√°vel */
            .left-panel {
                position: fixed;
                top: 80px;
                left: -280px;
                width: 280px;
                height: calc(100vh - 80px);
                background: rgba(0, 0, 0, 0.95);
                transition: left 0.3s ease;
                z-index: 1500;
                border-right: 1px solid rgba(255, 255, 255, 0.2);
            }
            
            .left-panel.mobile-open {
                left: 0;
            }
            
            .right-panel {
                display: none;
            }
            
            /* Bot√£o para abrir painel m√≥vel */
            .mobile-menu-btn {
                display: block;
                position: fixed;
                top: 90px;
                left: 10px;
                z-index: 2000;
                padding: 10px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                color: white;
                cursor: pointer;
                backdrop-filter: blur(10px);
            }
            
            .legend {
                position: fixed;
                bottom: 10px;
                left: 10px;
                right: 10px;
                padding: 15px;
            }
            
            .legend-grid {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
            
            /* Ajustes nos controles para mobile */
            .controls-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .panel-title {
                font-size: 1rem;
            }
            
            .config-item {
                padding: 6px 10px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 10px 12px;
            }
            
            .header h1 {
                font-size: 1.1rem;
            }
            
            .left-panel {
                width: 100vw;
                left: -100vw;
            }
            
            .left-panel.mobile-open {
                left: 0;
            }
            
            .legend {
                padding: 12px;
            }
            
            .legend-grid {
                grid-template-columns: 1fr;
            }
            
            .panel-card {
                padding: 12px;
            }
        }

        /* Bot√£o menu mobile (oculto por padr√£o) */
        .mobile-menu-btn {
            display: none;
            font-size: 1.2rem;
        }

        /* Overlay para mobile */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1400;
        }

        .mobile-overlay.show {
            display: block;
        }

        /* Sistema de Logs */
        .logs-panel {
            position: absolute;
            bottom: 20px;
            right: 340px;
            width: 400px;
            max-height: 300px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            backdrop-filter: blur(20px);
            display: none;
            overflow: hidden;
        }

        .logs-panel.show {
            display: block;
            animation: slideInUp 0.3s ease;
        }

        .logs-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logs-content {
            padding: 0;
            max-height: 220px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.8rem;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: rgba(255, 255, 255, 0.5);
            margin-right: 8px;
        }

        .log-level-info { color: #3498db; }
        .log-level-success { color: #27ae60; }
        .log-level-warning { color: #f39c12; }
        .log-level-error { color: #e74c3c; }

        .export-btn {
            padding: 6px 12px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        /* Logs responsivo */
        @media (max-width: 1024px) {
            .logs-panel {
                right: 20px;
                width: 350px;
            }
        }

        @media (max-width: 768px) {
            .logs-panel {
                position: fixed;
                bottom: 100px;
                left: 10px;
                right: 10px;
                width: auto;
                max-height: 200px;
            }
        }

        /* Loading animation */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 3000;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="network-container">
        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
        </div>

        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div>
                    <h1>üåê Mapa de Rede Interativo</h1>
                    <p class="subtitle">Visualiza√ß√£o da arquitetura do sistema legislativo em tempo real</p>
                </div>
                <div class="header-actions">
                    <button class="header-btn" onclick="toggleLogsPanel()">üìã Logs</button>
                    <a href="index.html" class="header-btn">‚Üê Voltar</a>
                    <button class="header-btn" onclick="toggleFullscreen()">‚õ∂ Tela Cheia</button>
                </div>
            </div>
        </div>

        <!-- Painel Esquerdo -->
        <div class="left-panel">
            <!-- Controles -->
            <div class="panel-card">
                <h3 class="panel-title">üéÆ Controles de Simula√ß√£o</h3>
                <div class="controls-grid">
                    <button class="btn success" onclick="iniciarSimulacao()">‚ñ∂Ô∏è Iniciar</button>
                    <button class="btn warning" onclick="pausarSimulacao()">‚è∏Ô∏è Pausar</button>
                    <button class="btn danger" onclick="pararSimulacao()">‚èπÔ∏è Parar</button>
                    <button class="btn" onclick="resetarRede()">üîÑ Reset</button>
                </div>
                <button class="btn primary" onclick="executarFluxoCompleto()" style="grid-column: 1/-1; margin-top: 8px;">
                    üöÄ Fluxo Completo
                </button>
            </div>

            <!-- Configura√ß√µes -->
            <div class="panel-card">
                <h3 class="panel-title">‚öôÔ∏è Configura√ß√µes</h3>
                
                <div class="config-item">
                    <span class="config-label">Mostrar R√≥tulos</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showLabels" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="config-item">
                    <span class="config-label">Part√≠culas de Fundo</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showParticles" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="config-item">
                    <span class="config-label">Layout Autom√°tico</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoLayout" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="config-item">
                    <span class="config-label">For√ßa dos N√≥s</span>
                </div>
                <div class="range-slider">
                    <input type="range" class="range-input" id="forceStrength" min="100" max="2000" value="800">
                </div>

                <div class="config-item">
                    <span class="config-label">Velocidade: <span id="speedValue">1.0x</span></span>
                </div>
                <div class="range-slider">
                    <input type="range" class="range-input" id="speedSlider" min="0.1" max="3" step="0.1" value="1">
                </div>
            </div>

            <!-- Performance Monitor -->
            <div class="panel-card">
                <h3 class="panel-title">‚ö° Performance</h3>
                
                <div class="perf-metric">
                    <span>CPU Usage</span>
                    <span id="cpuValue">0%</span>
                </div>
                <div class="perf-bar">
                    <div class="perf-fill perf-cpu" id="cpuBar" style="width: 0%"></div>
                </div>
                
                <div class="perf-metric">
                    <span>Memory</span>
                    <span id="memoryValue">0%</span>
                </div>
                <div class="perf-bar">
                    <div class="perf-fill perf-memory" id="memoryBar" style="width: 0%"></div>
                </div>
                
                <div class="perf-metric">
                    <span>Network</span>
                    <span id="networkValue">0%</span>
                </div>
                <div class="perf-bar">
                    <div class="perf-fill perf-network" id="networkBar" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Painel Direito -->
        <div class="right-panel">
            <!-- Estat√≠sticas -->
            <div class="panel-card">
                <h3 class="panel-title">üìä Estat√≠sticas da Rede</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalNodes">15</div>
                        <div class="stat-label">N√≥s Ativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeConnections">12</div>
                        <div class="stat-label">Conex√µes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="documentsProcessed">0</div>
                        <div class="stat-label">Documentos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="networkLoad">15%</div>
                        <div class="stat-label">Carga Rede</div>
                    </div>
                </div>
            </div>

            <!-- Status da Simula√ß√£o -->
            <div class="panel-card">
                <h3 class="panel-title">üìà Status da Simula√ß√£o</h3>
                <div class="config-item">
                    <span class="config-label">Estado Atual</span>
                    <span id="simulationStatus" style="color: #38ef7d;">Parado</span>
                </div>
                <div class="config-item">
                    <span class="config-label">Etapa Atual</span>
                    <span id="currentStep">0/9</span>
                </div>
                <div class="config-item">
                    <span class="config-label">Progresso</span>
                </div>
                <div class="perf-bar">
                    <div class="perf-fill" id="progressBar" style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Legenda -->
        <div class="legend">
            <h3 class="panel-title">üè∑Ô∏è Legenda de Tipos</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-dot" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                    <span>Usu√°rios</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                    <span>Processos</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);"></div>
                    <span>Documentos</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);"></div>
                    <span>Sistema</span>
                </div>
            </div>
        </div>

        <!-- Bot√£o Menu Mobile -->
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>

        <!-- Overlay Mobile -->
        <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>

        <!-- Painel de Logs -->
        <div class="logs-panel" id="logsPanel">
            <div class="logs-header">
                <h3 class="panel-title">üìã Log de Execu√ß√£o</h3>
                <div>
                    <button class="export-btn" onclick="exportLogs()">üíæ Exportar</button>
                    <button class="header-btn" onclick="clearLogs()" style="margin-left: 8px; padding: 4px 8px; font-size: 0.7rem;">üóëÔ∏è</button>
                </div>
            </div>
            <div class="logs-content" id="logsContent">
                <!-- Logs ser√£o inseridos aqui dinamicamente -->
            </div>
        </div>

        <!-- SVG Principal -->
        <svg class="network-svg" id="networkSvg">
            <!-- Defini√ß√µes de gradientes -->
            <defs>
                <radialGradient id="gradientUser" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" style="stop-color:#764ba2" />
                    <stop offset="100%" style="stop-color:#667eea" />
                </radialGradient>
                <radialGradient id="gradientProcess" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" style="stop-color:#f5576c" />
                    <stop offset="100%" style="stop-color:#f093fb" />
                </radialGradient>
                <radialGradient id="gradientDocument" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" style="stop-color:#38ef7d" />
                    <stop offset="100%" style="stop-color:#11998e" />
                </radialGradient>
                <radialGradient id="gradientSystem" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" style="stop-color:#3f5efb" />
                    <stop offset="100%" style="stop-color:#fc466b" />
                </radialGradient>
            </defs>
        </svg>

        <!-- Tooltip -->
        <div class="tooltip" id="tooltip"></div>

        <!-- Info Panel -->
        <div class="info-panel" id="infoPanel">
            <h3 class="panel-title">üìã Detalhes do N√≥</h3>
            <div id="nodeDetails"></div>
        </div>
    </div>

    <script>
        // Configura√ß√£o global
        let networkData = {
            nodes: [
                { id: 'admin', name: 'Administrador', type: 'user', icon: 'üëë', status: 'idle', description: 'Configura templates e par√¢metros do sistema' },
                { id: 'parlamentar', name: 'Parlamentar', type: 'user', icon: 'üèõÔ∏è', status: 'idle', description: 'Cria e edita proposi√ß√µes legislativas' },
                { id: 'legislativo', name: 'Legislativo', type: 'user', icon: '‚öñÔ∏è', status: 'idle', description: 'Analisa e processa proposi√ß√µes' },
                { id: 'protocolo', name: 'Protocolo', type: 'user', icon: 'üìã', status: 'idle', description: 'Atribui numera√ß√£o oficial' },
                
                { id: 'templates', name: 'Gest√£o de Templates', type: 'process', icon: 'üìÑ', status: 'idle', description: 'Sistema de templates de documentos' },
                { id: 'editor', name: 'Editor de Texto', type: 'process', icon: '‚úèÔ∏è', status: 'idle', description: 'Interface de cria√ß√£o de proposi√ß√µes' },
                { id: 'onlyoffice', name: 'OnlyOffice', type: 'system', icon: 'üìù', status: 'idle', description: 'Editor colaborativo de documentos' },
                { id: 'assinatura', name: 'Assinatura Digital', type: 'process', icon: '‚úçÔ∏è', status: 'idle', description: 'Sistema de assinatura eletr√¥nica' },
                
                { id: 'doc_inicial', name: 'Documento Inicial', type: 'document', icon: 'üìÑ', status: 'idle', description: 'Proposi√ß√£o criada pelo parlamentar' },
                { id: 'doc_editado', name: 'Documento Revisado', type: 'document', icon: 'üìù', status: 'idle', description: 'Proposi√ß√£o ap√≥s an√°lise legislativa' },
                { id: 'pdf_assinado', name: 'PDF Assinado', type: 'document', icon: 'üìú', status: 'idle', description: 'Documento final com assinatura digital' },
                
                { id: 'database', name: 'PostgreSQL', type: 'system', icon: 'üóÑÔ∏è', status: 'idle', description: 'Banco de dados principal' },
                { id: 'redis', name: 'Redis Cache', type: 'system', icon: '‚ö°', status: 'idle', description: 'Cache distribu√≠do' },
                { id: 'storage', name: 'File Storage', type: 'system', icon: 'üíæ', status: 'idle', description: 'Armazenamento de arquivos' },
                { id: 'api', name: 'API Gateway', type: 'system', icon: 'üåê', status: 'idle', description: 'Interface de comunica√ß√£o' }
            ],
            links: [
                { source: 'admin', target: 'templates', type: 'config', description: 'Configura templates' },
                { source: 'templates', target: 'database', type: 'store', description: 'Armazena configura√ß√µes' },
                { source: 'parlamentar', target: 'editor', type: 'action', description: 'Cria proposi√ß√£o' },
                { source: 'editor', target: 'doc_inicial', type: 'create', description: 'Gera documento' },
                { source: 'doc_inicial', target: 'legislativo', type: 'flow', description: 'Envia para an√°lise' },
                { source: 'legislativo', target: 'onlyoffice', type: 'edit', description: 'Edita documento' },
                { source: 'onlyoffice', target: 'doc_editado', type: 'save', description: 'Salva altera√ß√µes' },
                { source: 'doc_editado', target: 'parlamentar', type: 'return', description: 'Retorna ao autor' },
                { source: 'parlamentar', target: 'assinatura', type: 'sign', description: 'Assina digitalmente' },
                { source: 'assinatura', target: 'pdf_assinado', type: 'generate', description: 'Gera PDF final' },
                { source: 'pdf_assinado', target: 'protocolo', type: 'protocol', description: 'Protocola√ß√£o' },
                { source: 'database', target: 'redis', type: 'cache', description: 'Cache de dados' },
                { source: 'doc_editado', target: 'storage', type: 'store', description: 'Arquiva documento' },
                { source: 'pdf_assinado', target: 'storage', type: 'archive', description: 'Arquivo permanente' },
                { source: 'api', target: 'onlyoffice', type: 'api', description: 'Comunica√ß√£o API' }
            ]
        };

        let simulation;
        let svg, g;
        let simulationRunning = false;
        let currentStepIndex = 0;
        let animationSpeed = 1;
        let width, height;

        // Sistema de logs
        let logs = [];
        let sessionStartTime = new Date();
        let totalExecutionTime = 0;
        let stepTimings = [];
        let performanceMetrics = {
            avgCPU: 0,
            avgMemory: 0,
            avgNetwork: 0,
            peakCPU: 0,
            peakMemory: 0,
            peakNetwork: 0
        };

        // Sequ√™ncia do fluxo legislativo
        const fluxoCompleto = [
            { 
                step: 1, 
                description: 'Admin configura templates',
                nodes: ['admin'],
                links: ['admin-templates'],
                action: () => updateNodeStatus('admin', 'active')
            },
            { 
                step: 2, 
                description: 'Templates salvos no banco',
                nodes: ['templates', 'database'],
                links: ['templates-database'],
                action: () => {
                    updateNodeStatus('templates', 'active');
                    updateLinkStatus('admin', 'templates', 'active');
                }
            },
            { 
                step: 3, 
                description: 'Parlamentar cria proposi√ß√£o',
                nodes: ['parlamentar', 'editor'],
                links: ['parlamentar-editor'],
                action: () => {
                    updateNodeStatus('admin', 'success');
                    updateNodeStatus('templates', 'success');
                    updateNodeStatus('parlamentar', 'active');
                    updateLinkStatus('templates', 'database', 'success');
                }
            },
            { 
                step: 4, 
                description: 'Documento inicial criado',
                nodes: ['doc_inicial'],
                links: ['editor-doc_inicial'],
                action: () => {
                    updateNodeStatus('editor', 'active');
                    updateLinkStatus('parlamentar', 'editor', 'active');
                }
            },
            { 
                step: 5, 
                description: 'Enviado para Legislativo',
                nodes: ['legislativo'],
                links: ['doc_inicial-legislativo'],
                action: () => {
                    updateNodeStatus('doc_inicial', 'success');
                    updateNodeStatus('legislativo', 'active');
                    updateLinkStatus('editor', 'doc_inicial', 'success');
                }
            },
            { 
                step: 6, 
                description: 'Edi√ß√£o no OnlyOffice',
                nodes: ['onlyoffice'],
                links: ['legislativo-onlyoffice'],
                action: () => {
                    updateNodeStatus('onlyoffice', 'active');
                    updateLinkStatus('doc_inicial', 'legislativo', 'success');
                    updateLinkStatus('legislativo', 'onlyoffice', 'active');
                }
            },
            { 
                step: 7, 
                description: 'Documento revisado',
                nodes: ['doc_editado'],
                links: ['onlyoffice-doc_editado'],
                action: () => {
                    updateNodeStatus('doc_editado', 'success');
                    updateLinkStatus('onlyoffice', 'doc_editado', 'success');
                }
            },
            { 
                step: 8, 
                description: 'Assinatura digital',
                nodes: ['assinatura'],
                links: ['parlamentar-assinatura'],
                action: () => {
                    updateNodeStatus('assinatura', 'active');
                    updateLinkStatus('doc_editado', 'parlamentar', 'success');
                    updateLinkStatus('parlamentar', 'assinatura', 'active');
                }
            },
            { 
                step: 9, 
                description: 'PDF final e protocolo',
                nodes: ['pdf_assinado', 'protocolo'],
                links: ['assinatura-pdf_assinado', 'pdf_assinado-protocolo'],
                action: () => {
                    updateNodeStatus('pdf_assinado', 'success');
                    updateNodeStatus('protocolo', 'active');
                    updateLinkStatus('assinatura', 'pdf_assinado', 'success');
                    updateLinkStatus('pdf_assinado', 'protocolo', 'active');
                    setTimeout(() => {
                        updateNodeStatus('protocolo', 'success');
                        updateLinkStatus('pdf_assinado', 'protocolo', 'success');
                        document.getElementById('simulationStatus').textContent = 'Conclu√≠do';
                        document.getElementById('simulationStatus').style.color = '#38ef7d';
                    }, 1000);
                }
            }
        ];

        // Inicializa√ß√£o
        function initNetwork() {
            // Remover loading
            document.getElementById('loading').style.display = 'none';

            svg = d3.select('#networkSvg');
            g = svg.append('g');
            
            width = window.innerWidth;
            height = window.innerHeight;
            
            // Configurar zoom e pan
            const zoom = d3.zoom()
                .scaleExtent([0.1, 4])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });
                
            svg.call(zoom);
            
            // Configurar simula√ß√£o de for√ßa
            simulation = d3.forceSimulation(networkData.nodes)
                .force('link', d3.forceLink(networkData.links).id(d => d.id).distance(120))
                .force('charge', d3.forceManyBody().strength(-800))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(35))
                .force('x', d3.forceX().strength(0.1))
                .force('y', d3.forceY().strength(0.1));

            drawNetwork();
            updateStats();
            startPerformanceMonitoring();
            setupEventListeners();
        }

        function drawNetwork() {
            // Limpar conte√∫do anterior
            g.selectAll('*').remove();

            // Desenhar links
            const links = g.selectAll('.link')
                .data(networkData.links)
                .enter()
                .append('line')
                .attr('class', 'link link-default')
                .attr('id', d => `link-${d.source.id || d.source}-${d.target.id || d.target}`);

            // Grupo dos n√≥s
            const nodeGroups = g.selectAll('.node')
                .data(networkData.nodes)
                .enter()
                .append('g')
                .attr('class', 'node')
                .attr('id', d => `node-${d.id}`)
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended))
                .on('mouseover', showTooltip)
                .on('mouseout', hideTooltip)
                .on('click', showNodeDetails);

            // C√≠rculos dos n√≥s
            nodeGroups.append('circle')
                .attr('class', 'node-circle')
                .attr('r', 28)
                .attr('class', d => `node-${d.type} node-circle`);

            // √çcones dos n√≥s
            nodeGroups.append('text')
                .attr('class', 'node-icon')
                .attr('dy', '0.35em')
                .text(d => d.icon);

            // Labels dos n√≥s
            nodeGroups.append('text')
                .attr('class', 'node-label')
                .attr('y', 45)
                .text(d => d.name);

            // Configurar simula√ß√£o
            simulation.nodes(networkData.nodes);
            simulation.force('link').links(networkData.links);
            
            simulation.on('tick', () => {
                links
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                nodeGroups
                    .attr('transform', d => `translate(${d.x}, ${d.y})`);
            });

            simulation.alpha(1).restart();
        }

        // Fun√ß√µes de controle
        function iniciarSimulacao() {
            if (simulationRunning) return;
            
            simulationRunning = true;
            currentStepIndex = 0;
            document.getElementById('simulationStatus').textContent = 'Em Execu√ß√£o';
            document.getElementById('simulationStatus').style.color = '#667eea';
            
            // Reset todos os n√≥s
            networkData.nodes.forEach(node => node.status = 'idle');
            g.selectAll('.node-circle')
                .attr('class', d => `node-${d.type} node-circle`);
            g.selectAll('.link')
                .attr('class', 'link link-default');
            
            executeNextStep();
        }

        function executeNextStep() {
            if (!simulationRunning || currentStepIndex >= fluxoCompleto.length) {
                simulationRunning = false;
                return;
            }
            
            const step = fluxoCompleto[currentStepIndex];
            console.log(`Executando etapa ${step.step}: ${step.description}`);
            
            // Executar a√ß√£o da etapa
            step.action();
            
            // Atualizar UI
            document.getElementById('currentStep').textContent = `${step.step}/9`;
            const progress = ((step.step / 9) * 100);
            document.getElementById('progressBar').style.width = progress + '%';
            
            currentStepIndex++;
            
            // Agendar pr√≥xima etapa
            setTimeout(executeNextStep, 2000 / animationSpeed);
        }

        function executarFluxoCompleto() {
            pararSimulacao();
            setTimeout(iniciarSimulacao, 500);
        }

        function pausarSimulacao() {
            simulationRunning = false;
            document.getElementById('simulationStatus').textContent = 'Pausado';
            document.getElementById('simulationStatus').style.color = '#f093fb';
        }

        function pararSimulacao() {
            simulationRunning = false;
            currentStepIndex = 0;
            
            // Reset estado
            networkData.nodes.forEach(node => node.status = 'idle');
            g.selectAll('.node-circle')
                .attr('class', d => `node-${d.type} node-circle`);
            g.selectAll('.link')
                .attr('class', 'link link-default');
            
            document.getElementById('simulationStatus').textContent = 'Parado';
            document.getElementById('simulationStatus').style.color = '#38ef7d';
            document.getElementById('currentStep').textContent = '0/9';
            document.getElementById('progressBar').style.width = '0%';
            updateStats();
        }

        function resetarRede() {
            pararSimulacao();
            simulation.alpha(1).restart();
        }

        // Fun√ß√µes de atualiza√ß√£o de status
        function updateNodeStatus(nodeId, status) {
            const node = networkData.nodes.find(n => n.id === nodeId);
            if (node) {
                node.status = status;
                const nodeElement = g.select(`#node-${nodeId} .node-circle`);
                nodeElement.attr('class', `node-${node.type} node-circle node-${status}`);
            }
            updateStats();
        }

        function updateLinkStatus(sourceId, targetId, status) {
            const linkElement = g.select(`#link-${sourceId}-${targetId}`);
            linkElement.attr('class', `link link-${status}`);
        }

        // Tooltip e detalhes
        function showTooltip(event, d) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `
                <h4>${d.icon} ${d.name}</h4>
                <strong>Tipo:</strong> ${d.type}<br>
                <strong>Status:</strong> ${d.status}<br>
                <strong>Descri√ß√£o:</strong> ${d.description}
            `;
            tooltip.className = 'tooltip show';
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.className = 'tooltip';
        }

        function showNodeDetails(event, d) {
            const panel = document.getElementById('infoPanel');
            const details = document.getElementById('nodeDetails');
            
            const connections = networkData.links.filter(l => 
                (l.source.id || l.source) === d.id || (l.target.id || l.target) === d.id
            );
            
            details.innerHTML = `
                <div style="margin-bottom: 12px;">
                    <strong style="color: #667eea;">${d.icon} ${d.name}</strong>
                </div>
                <p style="margin-bottom: 8px;"><strong>Tipo:</strong> ${d.type}</p>
                <p style="margin-bottom: 8px;"><strong>Status:</strong> <span style="color: ${getStatusColor(d.status)}">${d.status}</span></p>
                <p style="margin-bottom: 8px;"><strong>Conex√µes:</strong> ${connections.length}</p>
                <p style="margin-bottom: 8px;"><strong>Descri√ß√£o:</strong></p>
                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">${d.description}</p>
            `;
            
            panel.className = 'info-panel show';
            setTimeout(() => panel.className = 'info-panel', 5000);
        }

        function getStatusColor(status) {
            const colors = {
                'idle': '#bdc3c7',
                'active': '#667eea',
                'success': '#38ef7d',
                'error': '#fc466b'
            };
            return colors[status] || '#bdc3c7';
        }

        // Estat√≠sticas
        function updateStats() {
            const activeNodes = networkData.nodes.filter(n => n.status === 'active').length;
            const successNodes = networkData.nodes.filter(n => n.status === 'success').length;
            const documentsProcessed = networkData.nodes.filter(n => n.type === 'document' && n.status === 'success').length;
            const totalLoad = Math.round(((activeNodes + successNodes) / networkData.nodes.length) * 100);

            document.getElementById('totalNodes').textContent = networkData.nodes.length;
            document.getElementById('activeConnections').textContent = networkData.links.length;
            document.getElementById('documentsProcessed').textContent = documentsProcessed;
            document.getElementById('networkLoad').textContent = totalLoad + '%';
        }

        // Performance monitoring
        function startPerformanceMonitoring() {
            setInterval(() => {
                const cpu = Math.random() * 100;
                const memory = Math.random() * 80;
                const network = Math.random() * 60;
                
                document.getElementById('cpuValue').textContent = Math.round(cpu) + '%';
                document.getElementById('cpuBar').style.width = cpu + '%';
                
                document.getElementById('memoryValue').textContent = Math.round(memory) + '%';
                document.getElementById('memoryBar').style.width = memory + '%';
                
                document.getElementById('networkValue').textContent = Math.round(network) + '%';
                document.getElementById('networkBar').style.width = network + '%';
            }, 3000);
        }

        // Event listeners
        function setupEventListeners() {
            // Speed slider
            document.getElementById('speedSlider').addEventListener('input', function() {
                animationSpeed = parseFloat(this.value);
                document.getElementById('speedValue').textContent = animationSpeed.toFixed(1) + 'x';
            });

            // Show labels toggle
            document.getElementById('showLabels').addEventListener('change', function() {
                g.selectAll('.node-label').style('display', this.checked ? 'block' : 'none');
            });

            // Auto layout toggle
            document.getElementById('autoLayout').addEventListener('change', function() {
                if (this.checked) {
                    simulation.alpha(0.3).restart();
                } else {
                    simulation.stop();
                }
            });

            // Force strength slider
            document.getElementById('forceStrength').addEventListener('input', function() {
                const strength = -parseInt(this.value);
                simulation.force('charge', d3.forceManyBody().strength(strength));
                simulation.alpha(0.3).restart();
            });
        }

        // Fun√ß√µes de drag
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // Fullscreen
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Window resize
        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            simulation.force('center', d3.forceCenter(width / 2, height / 2));
            simulation.alpha(0.3).restart();
        });

        // Sistema de Logging
        function addLog(level, message, data = null) {
            const timestamp = new Date();
            const logEntry = {
                timestamp,
                level,
                message,
                data,
                step: currentStepIndex,
                sessionTime: Math.round((timestamp - sessionStartTime) / 1000)
            };
            
            logs.push(logEntry);
            displayLog(logEntry);
            
            // Auto-scroll para o √∫ltimo log
            const logsContent = document.getElementById('logsContent');
            if (logsContent) {
                logsContent.scrollTop = logsContent.scrollHeight;
            }
        }

        function displayLog(logEntry) {
            const logsContent = document.getElementById('logsContent');
            if (!logsContent) return;
            
            const logElement = document.createElement('div');
            logElement.className = 'log-entry';
            
            const timeStr = logEntry.timestamp.toLocaleTimeString('pt-BR');
            logElement.innerHTML = `
                <span class="log-timestamp">[${timeStr}]</span>
                <span class="log-level-${logEntry.level}">[${logEntry.level.toUpperCase()}]</span>
                ${logEntry.message}
                ${logEntry.data ? ` - ${JSON.stringify(logEntry.data)}` : ''}
            `;
            
            logsContent.appendChild(logElement);
            
            // Limitar a 100 entradas vis√≠veis para performance
            if (logsContent.children.length > 100) {
                logsContent.removeChild(logsContent.firstChild);
            }
        }

        function clearLogs() {
            logs = [];
            const logsContent = document.getElementById('logsContent');
            if (logsContent) {
                logsContent.innerHTML = '';
            }
            addLog('info', 'Logs limpos pelo usu√°rio');
        }

        function exportLogs() {
            if (logs.length === 0) {
                alert('Nenhum log para exportar!');
                return;
            }
            
            const exportData = generateLogReport();
            const blob = new Blob([exportData], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `network-flow-log-${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addLog('success', 'Log exportado com sucesso', { entries: logs.length });
        }

        function generateLogReport() {
            const report = [];
            
            // Cabe√ßalho do relat√≥rio
            report.push('RELAT√ìRIO DE EXECU√á√ÉO - MAPA DE REDE INTERATIVO');
            report.push('='.repeat(60));
            report.push(`Data: ${sessionStartTime.toLocaleDateString('pt-BR')}`);
            report.push(`Hora de In√≠cio: ${sessionStartTime.toLocaleTimeString('pt-BR')}`);
            report.push(`Dura√ß√£o da Sess√£o: ${Math.round((new Date() - sessionStartTime) / 1000)}s`);
            report.push(`Total de Logs: ${logs.length}`);
            report.push('');
            
            // Resumo das etapas
            if (stepTimings.length > 0) {
                report.push('RESUMO DAS ETAPAS EXECUTADAS:');
                report.push('-'.repeat(40));
                stepTimings.forEach((timing, index) => {
                    report.push(`Etapa ${index + 1}: ${timing.description} - ${timing.duration}ms`);
                });
                report.push(`Tempo Total de Execu√ß√£o: ${totalExecutionTime}ms`);
                report.push('');
            }
            
            // M√©tricas de performance
            report.push('M√âTRICAS DE PERFORMANCE:');
            report.push('-'.repeat(40));
            report.push(`CPU M√©dio: ${performanceMetrics.avgCPU.toFixed(1)}% | Pico: ${performanceMetrics.peakCPU.toFixed(1)}%`);
            report.push(`Mem√≥ria M√©dia: ${performanceMetrics.avgMemory.toFixed(1)}% | Pico: ${performanceMetrics.peakMemory.toFixed(1)}%`);
            report.push(`Rede M√©dia: ${performanceMetrics.avgNetwork.toFixed(1)}% | Pico: ${performanceMetrics.peakNetwork.toFixed(1)}%`);
            report.push('');
            
            // Estat√≠sticas por n√≠vel
            const levelCounts = {};
            logs.forEach(log => {
                levelCounts[log.level] = (levelCounts[log.level] || 0) + 1;
            });
            
            report.push('ESTAT√çSTICAS POR N√çVEL:');
            report.push('-'.repeat(40));
            Object.entries(levelCounts).forEach(([level, count]) => {
                report.push(`${level.toUpperCase()}: ${count}`);
            });
            report.push('');
            
            // Log detalhado
            report.push('LOG DETALHADO:');
            report.push('-'.repeat(40));
            logs.forEach(log => {
                const timeStr = log.timestamp.toLocaleTimeString('pt-BR');
                const sessionTime = `+${log.sessionTime}s`;
                report.push(`[${timeStr}] [${sessionTime}] [${log.level.toUpperCase()}] ${log.message}`);
                if (log.data) {
                    report.push(`    Data: ${JSON.stringify(log.data, null, 2)}`);
                }
            });
            
            report.push('');
            report.push('='.repeat(60));
            report.push('Relat√≥rio gerado automaticamente pelo Sistema Legisinc');
            
            return report.join('\n');
        }

        // Responsividade Mobile
        function toggleMobileMenu() {
            const panel = document.querySelector('.left-panel');
            const overlay = document.getElementById('mobileOverlay');
            
            panel.classList.toggle('mobile-open');
            overlay.classList.toggle('show');
            
            addLog('info', 'Menu mobile ' + (panel.classList.contains('mobile-open') ? 'aberto' : 'fechado'));
        }

        function closeMobileMenu() {
            const panel = document.querySelector('.left-panel');
            const overlay = document.getElementById('mobileOverlay');
            
            panel.classList.remove('mobile-open');
            overlay.classList.remove('show');
        }

        function toggleLogsPanel() {
            const panel = document.getElementById('logsPanel');
            const isVisible = panel.classList.contains('show');
            
            if (isVisible) {
                panel.classList.remove('show');
                addLog('info', 'Painel de logs fechado');
            } else {
                panel.classList.add('show');
                addLog('info', 'Painel de logs aberto');
            }
        }

        // Melhorias nas fun√ß√µes existentes com logging
        function iniciarSimulacao() {
            if (simulationRunning) return;
            
            addLog('info', 'Iniciando simula√ß√£o do fluxo legislativo');
            simulationRunning = true;
            currentStepIndex = 0;
            stepTimings = [];
            totalExecutionTime = 0;
            
            document.getElementById('simulationStatus').textContent = 'Em Execu√ß√£o';
            document.getElementById('simulationStatus').style.color = '#667eea';
            
            // Reset todos os n√≥s
            networkData.nodes.forEach(node => node.status = 'idle');
            g.selectAll('.node-circle')
                .attr('class', d => `node-${d.type} node-circle`);
            g.selectAll('.link')
                .attr('class', 'link link-default');
            
            addLog('success', 'Simula√ß√£o iniciada com sucesso', { 
                totalSteps: fluxoCompleto.length,
                animationSpeed: animationSpeed 
            });
            
            executeNextStep();
        }

        function executeNextStep() {
            if (!simulationRunning || currentStepIndex >= fluxoCompleto.length) {
                simulationRunning = false;
                addLog('success', 'Simula√ß√£o conclu√≠da com sucesso', {
                    totalTime: totalExecutionTime,
                    stepsCompleted: currentStepIndex
                });
                return;
            }
            
            const stepStartTime = performance.now();
            const step = fluxoCompleto[currentStepIndex];
            
            addLog('info', `Executando etapa ${step.step}: ${step.description}`);
            
            // Executar a√ß√£o da etapa
            step.action();
            
            // Calcular timing da etapa
            const stepEndTime = performance.now();
            const stepDuration = stepEndTime - stepStartTime;
            totalExecutionTime += stepDuration;
            
            stepTimings.push({
                step: step.step,
                description: step.description,
                duration: Math.round(stepDuration)
            });
            
            // Atualizar UI
            document.getElementById('currentStep').textContent = `${step.step}/9`;
            const progress = ((step.step / 9) * 100);
            document.getElementById('progressBar').style.width = progress + '%';
            
            addLog('success', `Etapa ${step.step} conclu√≠da`, {
                duration: Math.round(stepDuration) + 'ms',
                progress: Math.round(progress) + '%'
            });
            
            currentStepIndex++;
            
            // Agendar pr√≥xima etapa
            setTimeout(executeNextStep, 2000 / animationSpeed);
        }

        function pararSimulacao() {
            if (simulationRunning) {
                addLog('warning', 'Simula√ß√£o interrompida pelo usu√°rio', {
                    stepsStopped: currentStepIndex,
                    totalSteps: fluxoCompleto.length
                });
            }
            
            simulationRunning = false;
            currentStepIndex = 0;
            
            // Reset estado
            networkData.nodes.forEach(node => node.status = 'idle');
            g.selectAll('.node-circle')
                .attr('class', d => `node-${d.type} node-circle`);
            g.selectAll('.link')
                .attr('class', 'link link-default');
            
            document.getElementById('simulationStatus').textContent = 'Parado';
            document.getElementById('simulationStatus').style.color = '#38ef7d';
            document.getElementById('currentStep').textContent = '0/9';
            document.getElementById('progressBar').style.width = '0%';
            updateStats();
            
            addLog('info', 'Simula√ß√£o parada e estado resetado');
        }

        // Monitoramento de performance aprimorado
        function startPerformanceMonitoring() {
            let cpuSamples = [];
            let memorySamples = [];
            let networkSamples = [];
            
            setInterval(() => {
                const cpu = Math.random() * 100;
                const memory = Math.random() * 80;
                const network = Math.random() * 60;
                
                // Armazenar amostras para c√°lculo de m√©dias
                cpuSamples.push(cpu);
                memorySamples.push(memory);
                networkSamples.push(network);
                
                // Manter apenas as √∫ltimas 20 amostras
                if (cpuSamples.length > 20) {
                    cpuSamples.shift();
                    memorySamples.shift();
                    networkSamples.shift();
                }
                
                // Calcular m√©dias e picos
                performanceMetrics.avgCPU = cpuSamples.reduce((a, b) => a + b) / cpuSamples.length;
                performanceMetrics.avgMemory = memorySamples.reduce((a, b) => a + b) / memorySamples.length;
                performanceMetrics.avgNetwork = networkSamples.reduce((a, b) => a + b) / networkSamples.length;
                
                performanceMetrics.peakCPU = Math.max(performanceMetrics.peakCPU, cpu);
                performanceMetrics.peakMemory = Math.max(performanceMetrics.peakMemory, memory);
                performanceMetrics.peakNetwork = Math.max(performanceMetrics.peakNetwork, network);
                
                // Atualizar UI
                document.getElementById('cpuValue').textContent = Math.round(cpu) + '%';
                document.getElementById('cpuBar').style.width = cpu + '%';
                
                document.getElementById('memoryValue').textContent = Math.round(memory) + '%';
                document.getElementById('memoryBar').style.width = memory + '%';
                
                document.getElementById('networkValue').textContent = Math.round(network) + '%';
                document.getElementById('networkBar').style.width = network + '%';
                
                // Log de performance cr√≠tica
                if (cpu > 90 || memory > 90 || network > 90) {
                    addLog('warning', 'Performance cr√≠tica detectada', {
                        cpu: Math.round(cpu),
                        memory: Math.round(memory),
                        network: Math.round(network)
                    });
                }
            }, 3000);
        }

        // Inicializa√ß√£o aprimorada
        function initNetwork() {
            addLog('info', 'Inicializando mapa de rede interativo');
            
            // Remover loading
            document.getElementById('loading').style.display = 'none';

            svg = d3.select('#networkSvg');
            g = svg.append('g');
            
            width = window.innerWidth;
            height = window.innerHeight;
            
            addLog('info', 'Configurando visualiza√ß√£o', { width, height });
            
            // Configurar zoom e pan
            const zoom = d3.zoom()
                .scaleExtent([0.1, 4])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });
                
            svg.call(zoom);
            
            // Configurar simula√ß√£o de for√ßa
            simulation = d3.forceSimulation(networkData.nodes)
                .force('link', d3.forceLink(networkData.links).id(d => d.id).distance(120))
                .force('charge', d3.forceManyBody().strength(-800))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(35))
                .force('x', d3.forceX().strength(0.1))
                .force('y', d3.forceY().strength(0.1));

            drawNetwork();
            updateStats();
            startPerformanceMonitoring();
            setupEventListeners();
            
            addLog('success', 'Mapa de rede inicializado com sucesso', {
                nodes: networkData.nodes.length,
                links: networkData.links.length
            });
        }

        // Event listeners responsivos
        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            simulation.force('center', d3.forceCenter(width / 2, height / 2));
            simulation.alpha(0.3).restart();
            
            addLog('info', 'Janela redimensionada', { newWidth: width, newHeight: height });
        });

        // Detectar mudan√ßas de orienta√ß√£o em mobile
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                width = window.innerWidth;
                height = window.innerHeight;
                simulation.force('center', d3.forceCenter(width / 2, height / 2));
                simulation.alpha(0.3).restart();
                
                addLog('info', 'Orienta√ß√£o alterada', { orientation: screen.orientation ? screen.orientation.angle : 'unknown' });
            }, 100);
        });

        // Inicializa√ß√£o
        window.addEventListener('load', () => {
            addLog('info', 'P√°gina carregada, iniciando sistema');
            initNetwork();
        });
    </script>
</body>
</html>